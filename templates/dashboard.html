{% extends "base.html" %}

{% block content %}
<h1 class="dashboard-title">Welcome to the Dashboard ðŸ˜ˆ</h1>

<!-- Elephant background video -->
<video id="bg-elephant" autoplay muted loop playsinline>
    <source src="{{ url_for('static', filename='Elephant_Green_Screen_Effect_Meme_But_Its_Actually_Green_Screen_-_Button_Mash_1080p_h264.mp4') }}" type="video/mp4">
</video>

<!-- Idiot sound (bass boosted by JS) -->
<audio id="idiot-sound" loop>
    <source src="{{ url_for('static', filename='you-are-an-idiot.mp3') }}" type="audio/mpeg">
</audio>
{% endblock %}

{% block scripts %}
<script>
/* ----------------------------------------------------------
   BACKGROUND VIDEO AUTOPLAY (must start muted)
---------------------------------------------------------- */
const bgVideo = document.getElementById("bg-elephant");
bgVideo.muted = true;     
bgVideo.play().catch(()=>{});

/* ----------------------------------------------------------
   BASS BOOST AUDIO EFFECT
---------------------------------------------------------- */
let prankStarted = false;
const idiotSound = document.getElementById("idiot-sound");

function startBassBoost() {
    const ctx = new (window.AudioContext || window.webkitAudioContext)();
    const src = ctx.createMediaElementSource(idiotSound);

    const bass = ctx.createBiquadFilter();
    bass.type = "lowshelf";
    bass.frequency.value = 120;     // boost <120 Hz
    bass.gain.value = 18;           // big bass

    src.connect(bass).connect(ctx.destination);
}

/* ----------------------------------------------------------
   START THE FULL CHAOS
---------------------------------------------------------- */
function startPrank() {
    if (prankStarted) return;
    prankStarted = true;

    startBassBoost();
    idiotSound.play().catch(()=>{});

    // flashing + shaking
    document.body.classList.add("flash", "shake");

    // bouncing text
    setInterval(spawnText, 500);

    // popups
    setInterval(showPopup, 6000);

    // redirect in 20 seconds (edit if you want)
    setTimeout(() => {
        window.location.href = "https://www.youtube.com/watch?v=dQw4w9WgXcQ";
    }, 20000);
}

/* ----------------------------------------------------------
   SPAWN â€œYOU ARE AN IDIOTâ€ TEXT
---------------------------------------------------------- */
function spawnText() {
    const div = document.createElement("div");
    div.className = "idiot-text";
    div.textContent = "YOU ARE AN IDIOT";

    const w = window.innerWidth;
    const h = window.innerHeight;

    div.style.left = Math.random() * (w - 200) + "px";
    div.style.top  = Math.random() * (h - 100) + "px";
    div.style.color = `hsl(${Math.random()*360},100%,50%)`;
    div.style.animationDuration = 2 + Math.random()*4 + "s";

    document.body.appendChild(div);

    setTimeout(() => div.remove(), 6000);
}

/* ----------------------------------------------------------
   POPUP WINDOW
---------------------------------------------------------- */
function showPopup() {
    const overlay = document.createElement("div");
    overlay.className = "popup-overlay";

    overlay.innerHTML = `
        <div class="popup-window">
            <h2>Warning</h2>
            <p>Elephant approaching your location.</p>
            <button onclick="this.closest('.popup-overlay').remove()">OK</button>
        </div>
    `;

    document.body.appendChild(overlay);
}

/* ----------------------------------------------------------
   AUTOPLAY FAILSAFE (start prank on first click)
---------------------------------------------------------- */
idiotSound.play()
    .then(startPrank)
    .catch(() => {
        document.addEventListener("click", () => {
            idiotSound.play();
            startPrank();
        }, { once: true });
    });
</script>

<style>
/* Fullscreen elephant video behind everything */
#bg-elephant {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    z-index: -10;
    filter: brightness(0.75) contrast(1.2);
}

/* Title visible above chaotic background */
.dashboard-title {
    position: relative;
    z-index: 10;
    text-shadow: 0 0 12px black;
}
</style>
{% endblock %}
