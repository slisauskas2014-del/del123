{% extends "base.html" %}

{% block content %}
<h1>You are a dumbass. Get fuckkkkkkkkkkkked</h1>

<audio id="idiot-sound" loop>
    <source src="{{ url_for('static', filename='you-are-an-idiot.mp3') }}" type="audio/mpeg">
</audio>
{% endblock %}

{% block scripts %}
<script>
    const audio = document.getElementById("idiot-sound");
    let prankStarted = false;

    function startPrank() {
        if (prankStarted) return;
        prankStarted = true;

        // Flash + shake
        document.body.classList.add("flash", "shake");

        // Spawn bouncing text every 500 ms
        setInterval(spawnIdiotText, 500);

        // Show fake popup every 6 seconds
        setInterval(showFakePopup, 6000);

        // OPTIONAL: redirect after 20 seconds
        // Remove this block if you don't want a redirect.
        setTimeout(() => {
            window.location.href = "https://www.google.com/search?q=you+are+an+idiot";
        }, 20000);
    }

    function spawnIdiotText() {
        const div = document.createElement("div");
        div.className = "idiot-text";
        div.textContent = "YOU ARE AN IDIOT";

        const w = window.innerWidth;
        const h = window.innerHeight;

        const x = Math.random() * (w - 200);
        const y = Math.random() * (h - 100);

        div.style.left = x + "px";
        div.style.top = y + "px";
        div.style.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
        div.style.animationDuration = (3 + Math.random() * 3) + "s";

        document.body.appendChild(div);

        setTimeout(() => {
            div.remove();
        }, 8000);
    }

    function showFakePopup() {
        const overlay = document.createElement("div");
        overlay.className = "popup-overlay";

        const popup = document.createElement("div");
        popup.className = "popup-window";

        popup.innerHTML = `
            <h2>System Warning</h2>
            <p>Multiple idiot activities detected on this device.</p>
            <button>OK</button>
        `;

        const button = popup.querySelector("button");
        button.addEventListener("click", () => {
            overlay.remove();
        });

        overlay.appendChild(popup);
        document.body.appendChild(overlay);
    }

    // Try to autoplay audio and start prank
    audio.play().then(() => {
        startPrank();
    }).catch(() => {
        console.log("Autoplay blocked â€” waiting for user interaction");

        const clickHandler = () => {
            audio.play().then(() => {
                startPrank();
            }).catch(err => {
                console.error("Audio still blocked:", err);
            });

            document.removeEventListener("click", clickHandler);
        };

        document.addEventListener("click", clickHandler);
    });
</script>
{% endblock %}
